<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Adapted from: https://bl.ocks.org/d3noob/8323795 -->
    <base target="_top">
    <meta charset="utf-8">
    <title>SocioAtlas - Relação de fatores</title>
    <style>
      .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 1.5px;
      }

      .node text {
        font: 12px sans-serif;
      }

      .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 1.5px;
      }
    </style>
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->
  </head>
  <body>
    <!-- load the d3.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script>
      /* Modelo de dados
      var treeData1 = [{
        "name": "Top Level",
        "parent": "null",
        "children": [{
          "name": "Level 2 A",
          "parent": "Top Level",
          "children": [{
            "name": "Son of A",
            "parent": "Level 2 A"
          }, {
            "name": "Daughter of A",
            "parent": "Level 2 A"
          }]
        }, {
          "name": "Level 2 B",
          "parent": "Top Level"
        }]
      }];
      console.log(treeData1);
      */
      // ************** Generate the tree diagram	 *****************
      function onFactors(treeData) {
        //console.log(treeData);
        var margin = {
            top: 20,
            right: 120,
            bottom: 20,
            left: 120
          },
          width = 1000 - margin.right - margin.left,
          height = 3800 - margin.top - margin.bottom;

        var i = 0;
        var tree = d3.layout.tree().size([height, width]).sort(function(a,b){
      return a.name.toLowerCase().localeCompare(b.name.toLowerCase());
    });
        var diagonal = d3.svg.diagonal().projection(function(d) {
          return [d.y, d.x];
        });
        var svg = d3.select("body").append("svg").attr("width", width + margin.right + margin.left).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        root = treeData[0];
        update(root);

        function update(source) {
          // Compute the new tree layout.
          var nodes = tree.nodes(root).reverse(),
            links = tree.links(nodes);
          // Normalize for fixed-depth.
          nodes.forEach(function(d) {
            d.y = d.depth * 180;
          });
          // Declare the nodes…
          var node = svg.selectAll("g.node").data(nodes, function(d) {
            return d.id || (d.id = ++i);
          });
          // Enter the nodes.
          var nodeEnter = node.enter().append("g").attr("class", "node").attr("transform", function(d) {
            return "translate(" + d.y + "," + d.x + ")";
          });
          nodeEnter.append("circle").attr("r", 10).style("fill", "#fff");
          nodeEnter.append("text").attr("x", function(d) {
            return d.children || d._children ? -13 : 13;
          }).attr("dy", ".35em").attr("text-anchor", function(d) {
            return d.children || d._children ? "end" : "start";
          }).text(function(d) {
            return d.name;
          }).style("fill-opacity", 1);
          // Declare the links…
          var link = svg.selectAll("path.link").data(links, function(d) {
            return d.target.id;
          });
          // Enter the links.
          link.enter().insert("path", "g").attr("class", "link").attr("d", diagonal);
        }
      };
      google.script.run.withSuccessHandler(onFactors).scan_Factors();
    </script>
  </body>
</html>